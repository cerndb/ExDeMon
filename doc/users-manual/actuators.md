# Actuators

Actions generated by [triggers](monitor-triggers.md) are processed by actuators.

Configuration is dynamically loaded from [properties source](properties-source.md).

#### Templates

In some of the parameters of the actuators, marked with &lt;template&gt;, templates can be used to format the value.

The following strings will be replaced by the action corresponding information:
* &lt;monitor_id&gt;
* &lt;trigger_id&gt;
* &lt;attribute_value:key&gt; (will be replaced by the value of the specified attribute key)
* &lt;attributes:keys_regex&gt; (will be replaced by a list, key = value)
* &lt;datetime[:(utc:ms)[:period]]&gt;
* &lt;reason&gt;
* &lt;triggering\_value&gt;
* &lt;source\_metrics&gt; &lt;filter\_expr:expression\_as\_in\_metrics\_filter&gt; &lt;attribute\_value:key&gt; &lt;attributes:key\_regex&gt; &lt;value&gt; &lt;datetime&gt; &lt;/source\_metrics&gt; (max size given by parameter: aggregate.last_source_metrics.max-size)
* &lt;tags&gt; (will be replaced by the tag list)
* &lt;tags:key&gt; (will be replaced by the value of the specified tag key)
* &lt;analysis_param:key&gt; (will be replaced by the value of the specified analysis parameter key)
* &lt;analysis_status&gt;

## Email actuator

Actions are sent by email.

```
actuators.<actuator-id>.type = email
actuators.<actuator-id>.session.mail.smtp.host = <email-server>
actuators.<actuator-id>.session.mail.smtp.auth = <true|false>
actuators.<actuator-id>.session.<others> = <value>
actuators.<actuator-id>.username = <from-email>
actuators.<actuator-id>.password = <from-email-password>
# Email info
actuators.<actuator-id>.to = <template> (default: <tags:email.to>)
actuators.<actuator-id>.subject = <template> (default: <tags:email.subject>)
actuators.<actuator-id>.text = <template> (default: <tags:email.text>)
```

## HTTP actuator

Actions are converted to JSON (array) and sunk to an HTTP (POST) end point.

```
actuators.<actuator-id>.type = http
actuators.<actuator-id>.url = <template>
actuators.<actuator-id>.parallelization = <number-of-parallel-clients> (default: 1)
actuators.<actuator-id>.batch.size = <max-number-of-records-in-a-POST-request> (default: 100)
actuators.<actuator-id>.as-array = <true|false> (default: true)
actuators.<actuator-id>.retries = <max-number-of-retries> (default: 5)
actuators.<actuator-id>.timeout = <max-wait-time-in-ms> (default: 5000)
# HTTP simple authentication
actuators.<actuator-id>.auth.type = <disabled|basic-user-password> (default: disabled)
actuators.<actuator-id>.auth.user = <username>
actuators.<actuator-id>.auth.password = <password>
# Add properties to JSON document
actuators.<actuator-id>.add.$action = <true|false> (default: true)
actuators.<actuator-id>.add.<key-1> = <template>
actuators.<actuator-id>.add.<key-2> = <template>
actuators.<actuator-id>.add.<key-n> = <template>
```

TIP: Send actions to [Mattermost](https://api.mattermost.com/)

More info: https://docs.mattermost.com/developer/webhooks-incoming.html

```
actuators.mattermost.type = http
actuators.mattermost.url = http://{your-mattermost-site}/hooks/xxx-generatedkey-xxx
actuators.mattermost.as-array = false
actuators.mattermost.add.$action = false
actuators.mattermost.add.text = <tags:matt-text>
actuators.mattermost.add.channel = <tags:matt-channel>
actuators.mattermost.add.username = <tags:matt-username>
actuators.mattermost.add.icon_url = https://raw.githubusercontent.com/cerndb/ExDeMon/master/graphics/icons/filled-<tags:icon>-icon.png
```

TIP: Run jobs in [Rundesk](http://rundeck.org/)

More info: https://docs.mattermost.com/developer/webhooks-incoming.html

```
actuators.rundeck.type = http
actuators.rundeck.url = https://{your-mattermost-site}/api/20/job/<tags:rundeck-jobid>/run
actuators.rundeck.as-array = false
actuators.rundeck.add.$action = false
actuators.rundeck.add.options.PARAM1 = <tags:rundeck-PARAM1>
actuators.rundeck.add.options.PARAM2 = <tags:rundeck-PARAM2>
```

## CERN GNI notifications actuator

Actions are converted to JSON (array) and sunk to an HTTP (POST) end point.

You can find all possible fields at: https://itmon.web.cern.ch/itmon/data_types/notifications_specification.html

Some fields are set by default but could be override. Default values:
* header.m_version = "2"
* header.m_type = "notification"
* body.metadata.timestamp = (current epoch seconds)
* body.metadata.uuid = (randomly generated UUID [+info](https://docs.oracle.com/javase/7/docs/api/java/util/UUID.html#randomUUID() )

Integer fields will be parsed properly.

```
actuators.<actuator-id>.type = cern-gni
actuators.<actuator-id>.url = <url>
actuators.<actuator-id>.parallelization = <number-of-parallel-clients> (default: 1)
actuators.<actuator-id>.batch.size = <max-number-of-records-in-a-POST-request> (default: 100)
actuators.<actuator-id>.retries = <max-number-of-retries> (default: 5)
actuators.<actuator-id>.timeout = <max-wait-time-in-ms> (default: 5000)
actuators.<actuator-id>.content.header.<header-key> = <template>
actuators.<actuator-id>.content.body.metadata.<metadata-key> = <template>
actuators.<actuator-id>.content.body.payload.<payload-key> = <template>
```
